<!DOCTYPE html>
<html>
<head>
    <!-- Vega -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.6.11/core.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.8.7/polyfill.js"></script>
    <script src="https://vega.github.io/vega/assets/promise.min.js"></script>
    <script src="https://vega.github.io/vega/assets/symbol.min.js"></script>
    <script src="https://vega.github.io/vega/assets/fetch.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5/build-es5/vega.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4/build-es5/vega-lite.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6/build-es5/vega-embed.js"></script>

    <!-- bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">

</head>
<body>

  <style>

  #chartDest {
    width: 100%;
    height: 400px;
  }

    #chartDest2 {
    width: 100%;
    height: 400px;
  }

  .fs-sm {
    font-size: 14px;
  }
  </style>



  <div class="container-fluid">
    <div class="row">
      <div class="col-md-8 col-sm-12 mx-auto">
        <h1>Raising the minimum wage would save lives</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent auctor augue ut vestibulum lobortis. Maecenas hendrerit elit nisl. Duis nibh mauris, tincidunt vitae viverra vel, vestibulum ut libero. Aenean arcu nisl, tincidunt at placerat id, convallis non enim. Proin sagittis vel arcu a dignissim. Quisque neque est, ultrices et lacus aliquam, convallis ornare arcu. Curabitur efficitur metus et risus pharetra finibus. Vestibulum tincidunt nunc in efficitur vehicula. In hac habitasse platea dictumst. Proin semper est leo, eu malesuada ligula tincidunt sit amet. Nulla ac tincidunt magna, sit amet commodo quam. Cras a sapien a ante pharetra tristique. Quisque iaculis leo vitae dapibus rutrum. In eu sem vitae turpis pulvinar porta ut eu dui.</p>


        <div class="row">
          <div class="col-4">
            <p>Minimum wage:</p>
                <button class="wagecontrol btn btn-sm btn-outline-primary active" data-value="b30">$30</button>
                <button class="wagecontrol btn btn-sm btn-outline-primary" data-value="a20">$20</button>         

            <hr>
            <p>Scenario</p>

                <button class="scenariocontrol btn btn-sm btn-outline-secondary active" data-value="scen1">1</button>
                <button class="scenariocontrol btn btn-sm btn-outline-secondary" data-value="scen2">2</button>
                <button class="scenariocontrol btn btn-sm btn-outline-secondary" data-value="scen3">3</button>
            <br><br>
            <div id="scen1" class="fs-sm">
            <p><strong>Scenario 1:</strong> the higher minimum wage raises wages of people who previously earned less than the new minimum wage, but does not affect employment.</p>
            </div>
            <div id="scen2" class="fs-sm">
            <p><strong>Scenario 2:</strong> a higher minimum wage creates "spillover effects:" people earning near the new minimum wage also see wage increases.</p>
            </div>
            <div id="scen3" class="fs-sm">

            <p><strong>Scenario 3:</strong> a higher minimum wage has no spillover effects, and also results in a 15% loss of minimum wage jobs.</p>
            </div>


            <!--
              <p>Data for:</p>

              <button class="btn btn-sm btn-outline-success">All NYC</button>
              <button class="btn btn-sm btn-outline-success active">By poverty</button>
            -->

          </div>

          <div class="col-4">
            <div id="chartDest">
              Chart goes here
            </div>

          </div>

            <div class="col-4">
            <div id="chartDest2">
              Chart goes here
            </div>

          </div>

          <div class="col-12">
            <div id="b30" class="mwage">
              A <strong>$30 minimum wage</strong> could:
                <ul>
                  <li>Reduce citywide poverty from 33.5% to somewhere between 27.7 and 31.2%.</li>
                  <li>Reduce the premature mortality rate (deaths before age 65, per 100,000 people) from 215.7 to between 195.4 and 207.6. This could <strong>prevent as many as 1,400 premature deaths</strong>.</li>
                </ul>
              <strong>These impacts would be much larger in neighborhoods with higher poverty.</strong>      
            </div>

            <div id="a20" class="mwage" style="display:none;">
              A <strong>$20 minimum wage</strong> could:
              <ul>
                <li>Reduce citywide poverty from 33.5% to somewhere between 32.2 and 33.6%.</li>
                <li>Reduce the premature mortality rate (deaths before age 65, per 100,000 people) from 215.7 to between 211 and 216. This represents as much as 2.6% of all premature deaths in NYC (in 2023).</li>
              </ul>
               In 2023, there were about 11,000 premature deaths in NYC.   
            </div>
          </div>
        </div>



        <div class="row" style="margin-top: 50px;">
          <div class="col-12">
            <div style="min-height:378px" id="datawrapper-vis-9QaVu"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/9QaVu/embed.js" charset="utf-8" data-target="#datawrapper-vis-9QaVu"></script><noscript><img src="https://datawrapper.dwcdn.net/9QaVu/full.png" alt="Table 1 (Table)" /></noscript></div>
          </div>
        </div>
      </div>
    </div>

  </div>

<script>
var wage = "b30";
var scenario = "scen1";


function redrawChart(settings) {
  drawChart(x,y,x)
}

function drawChart(w,s) {

  const newWage = w.includes('20') ? 'with $20 min wage' : w.includes('30') ? 'with $30 min wage' : 'Not sure'

  var height = 300

  var povertySpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": {
    "url": "https://gist.githubusercontent.com/mmontesanonyc/5a368f127bf226c42ec72c56e48fb955/raw/4d048c9798cff78c4d5b640a1315e606ad8028f9/minimumwage.csv"
  },
  "config": {
    "background": "#FFFFFF",
    "axisX": {
      "labelAngle": 0,
      "labelOverlap": "parity",
      "labelFontSize": 11,
      "titleFontSize": 13,
      "titleFont": "sans-serif",
      "titlePadding": 10,
      "domain": false,
      "ticks": false
    },
    "view": {"stroke": "transparent"},
    "axisY": {
      "domain": true,
      "domainColor": "lightgray",
      "ticks": true,
      "tickCount": 5
    }
  },
  "transform": [
    {"filter": `datum.MinWage==='${w}'`},
    // {"filter": "datum.Neighborhood!='NYC'"},
    {"filter": `datum.Scenario==='${s}'`},
    {"filter": "datum.Variable==='Poverty'"},
    {"calculate": "datum.Value/100", "as": "Value"},
    {
      "calculate": "datum.Neighborhood == 'veryhigh' ? 'Very high (50%+)' : datum.Neighborhood == 'high' ? 'High (35 to 49%)' : datum.Neighborhood == 'moderate' ? 'Moderate (20 to 34%)' : datum.Neighborhood == 'low' ? 'Low (Under 20%)' : 'All NYC: 29.2%'",
      "as": "PovLabel"
    },
  ],
        "title": "Poverty",
      "height": height,
      "width": "container",
      "mark": {
        "type": "line", 
        "point": {
          "filled": true,
          "size": 60
        }
      },
      "encoding": {
        "x": {
          "field": "Time",
          "type": "ordinal",
          "sort": ["before", "after"],
          "title": null,
          "axis": {
                  "labelExpr": `datum.value == 'Before' ? 'Current' : '${newWage}'`
                }
        },
        "y": {
          "field": "Value",
          "type": "quantitative",
          "title": null,
          "axis": {"format": ".0%"},
          "scale": {"domain": [0.1, 0.6]}
        },
        "color": {
            "condition": {
              "test": "datum.Neighborhood === 'NYC'",
              "value": "black"
            },
          "field": "Neighborhood",
          "type": "nominal",
          "title": "Neighborhood",
          "legend": null,
          "scale": {
                      "domain": ["low", "moderate", "high", "veryhigh"],
                      "range": ["#9ecae1", "#6baed6", "#8856a7", "#d01c8b"]
                    }
        },
        "strokeWidth": 3,
          "strokeDash": {
            "condition": [
              {
                "test": "datum.Neighborhood == 'NYC'",
                "value": [4,3]     // dashed pattern: 6px line, 3px gap
              }
            ]
          },
        "tooltip": [

          {"field": "PovLabel", "type": "ordinal", "title": "Neighborhood poverty"},
          {
            "field": "Value",
            "type": "quantitative",
            "title": "Poverty",
            "format": ".0%"
          },
                    {
            "field": "Time",
            "title": "Time"
          },
        ]
      }
}

var prematureMortSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": {
    "url": "https://gist.githubusercontent.com/mmontesanonyc/5a368f127bf226c42ec72c56e48fb955/raw/4d048c9798cff78c4d5b640a1315e606ad8028f9/minimumwage.csv"
  },
  "config": {
    "background": "#FFFFFF",
    "axisX": {
      "labelAngle": 0,
      "labelOverlap": "parity",
      "labelFontSize": 11,
      "titleFontSize": 13,
      "titleFont": "sans-serif",
      "titlePadding": 10,
      "domain": false,
      "ticks": false
    },
    "view": {"stroke": "transparent"},
    "axisY": {
      "domain": true,
      "domainColor": "lightgray",
      "ticks": true,
      "tickCount": 5
    }
  },
  "transform": [
    {"filter": `datum.MinWage==='${w}'`},
    // {"filter": "datum.Neighborhood!='NYC'"},
    {"filter": `datum.Scenario==='${s}'`},
    {"filter": "datum.Variable==='PrematureMort'"},
    {
      "calculate": "datum.Neighborhood == 'veryhigh' ? 'Very high (50%+)' : datum.Neighborhood == 'high' ? 'High (35 to 49%)' : datum.Neighborhood == 'moderate' ? 'Moderate (20 to 34%)' : datum.Neighborhood == 'low' ? 'Low (Under 20%)' : 'All NYC: 29.2%'",
      "as": "PovLabel"
    },
    {
      "calculate": "datum.Value + ' per 100,000 people'",
      "as": "ValueLabel"
    }
  ],
      "title": "Premature Mortality",
      "height": height,
      "width": "container",
      "mark": {
        "type": "line", 
        "point": {
          "filled": true,
          "size": 60
        }
      },
      "encoding": {
        "x": {
          "field": "Time",
          "type": "ordinal",
          "sort": ["before", "after"],
          "title": null,
          "axis": {
                  "labelExpr": `datum.value == 'Before' ? 'Current' : '${newWage}'`
                }
        },
        "y": {
          "field": "Value",
          "type": "quantitative",
          "title": null
        },
          "color": {
            "condition": {
              "test": "datum.Neighborhood === 'NYC'",
              "value": "black"
            },
          "field": "Neighborhood",
          "type": "nominal",
          "title": "Neighborhood",
          "legend": null,
          "scale": {
                      "domain": ["low", "moderate", "high", "veryhigh"],
                      "range": ["#9ecae1", "#6baed6", "#8856a7", "#d01c8b"]
                    }
        },
                "strokeWidth": 3,
          "strokeDash": {
            "condition": [
              {
                "test": "datum.Neighborhood == 'NYC'",
                "value": [4,3]     // dashed pattern: 6px line, 3px gap
              }
            ]
          },
        "tooltip": [

          {"field": "PovLabel", "type": "ordinal", "title": "Neighborhood poverty"},
          {"field": "ValueLabel", "type": "nominal", "title": "Premature mortality"},
          {
            "field": "Time",
            "title": "Time"
          }
        ]
      }
}


    vegaEmbed("#chartDest", povertySpec, { actions: false })
      .then(res => {
        window.addEventListener("resize", () => res.view.resize());
      });

          vegaEmbed("#chartDest2", prematureMortSpec, { actions: false })
      .then(res => {
        window.addEventListener("resize", () => res.view.resize());
      });

}

drawChart(wage,scenario);


// helper to wire up a group of buttons
function setupButtonGroup(selector, variableName) {
  const buttons = document.querySelectorAll(selector);

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      // remove active from all in this group
      buttons.forEach(b => b.classList.remove("active"));
      // add active to the clicked one
      btn.classList.add("active");

      // update variable
      if (variableName === "wage") {
        wage = btn.dataset.value;
        // Show corresponding div, hide others
        const wageDivs = document.querySelectorAll(".mwage");
        wageDivs.forEach(div => {
          div.style.display = div.id === wage ? "block" : "none";
        });


      } else if (variableName === "scenario") {
        scenario = btn.dataset.value;

        // Show corresponding div, hide others
        const scenarioDivs = document.querySelectorAll("div[id^='scen']");
        scenarioDivs.forEach(div => {
          div.style.display = div.id === scenario ? "block" : "none";
        });
      }

      console.log(`wage: ${wage}, scenario: ${scenario}`);
      drawChart(wage, scenario);
    });
  });
}

// initialize both groups
setupButtonGroup(".wagecontrol", "wage");
setupButtonGroup(".scenariocontrol", "scenario");

// optional: on page load, hide all scenario divs except default
document.querySelectorAll("div[id^='scen']").forEach(div => {
  div.style.display = div.id === scenario ? "block" : "none";
});


</script>



</body>
</html>